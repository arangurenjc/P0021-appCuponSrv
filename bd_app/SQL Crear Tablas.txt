/* SQL-92 Table Creation Script with DBISAM Extensions */

CREATE TABLE IF NOT EXISTS "C:\EMBARCADERO\Proyectos\021-appCupones\bd_app\tConfigApp"
(
  "FCA_RUTAAPP" VARCHAR(150), 
  "FCA_RUTAHAC" VARCHAR(150), 
  "FCA_POLITICAS" VARCHAR(10)

);


CREATE TABLE IF NOT EXISTS "C:\EMBARCADERO\Proyectos\021-appCupones\bd_app\tCajaMaestro"
(
  "FCM_IDCAJA" AutoInc, 
  "FCM_NOMBRE" VARCHAR(10), 
  "FCM_STATUS" Boolean, 
  "FCM_SERIE" VARCHAR(20), 
  "FCM_DETALLE" VARCHAR(100), 

PRIMARY KEY ("FCM_IDCAJA" ) COMPRESS NONE
LOCALE CODE 8202
USER MAJOR VERSION 1
);

CREATE INDEX IF NOT EXISTS "FCM_KEYNOMBRE" ON "C:\EMBARCADERO\Proyectos\021-appCupones\bd_app\tCajaMaestro" ("FCM_NOMBRE");



CREATE TABLE IF NOT EXISTS "C:\EMBARCADERO\Proyectos\021-appCupones\bd_app\tCuponEvento"
(
  "FCE_IDCUPON" AutoInc, 
  "FCE_DETALLE" VARCHAR(40), 
  "FCE_CONCEPTO" Memo, 
  "FCE_FECHAINI" Date, 
  "FCE_FECHAFIN" Date, 
  "FCE_CUPON" Integer, 
  "FCE_STATUS" Boolean, 

PRIMARY KEY ("FCE_IDCUPON" ) COMPRESS NONE
LOCALE CODE 8202
USER MAJOR VERSION 1
);

CREATE INDEX IF NOT EXISTS "FCE_KEYIDCUPON" ON "C:\EMBARCADERO\Proyectos\021-appCupones\bd_app\tCuponEvento" ("FCE_IDCUPON");




CREATE TABLE IF NOT EXISTS "C:\EMBARCADERO\Proyectos\021-appCupones\bd_app\tCuponDetalle"
(
  "FCD_AUTOINC" Integer, 
  "FCD_IDCAJA" Integer, 
  "FCD_IDCUPON" Integer, 
  "FCD_CUPONINI" MONEY, 
  "FCD_CUPONFIN" MONEY, 
  "FCD_FACTURA" VARCHAR(10), 
  "FCD_CLIENTECOD" VARCHAR(15), 
  "FCD_CLIENTENOM" VARCHAR(80), 
  "FCD_CLIENTETLF" VARCHAR(40), 
  "FCD_ITEMS" Integer, 
  "FCD_CANTCUPON" Integer, 
  "FCD_FECHA" DATE, 
  "FCD_HORA" TIME, 
  "FCD_TOTALUS" MONEY, 
  "FCD_TOTALBS" MONEY, 
  "FCD_TASA" MONEY, 
  "FCD_AUTOINC_OPERACION" Integer, 
  "FCD_TIPOREG" Integer, 
 
PRIMARY KEY ("FCD_AUTOINC" ) COMPRESS NONE
LOCALE CODE 8202
USER MAJOR VERSION 1
);

CREATE INDEX IF NOT EXISTS "FCD_KEYDETALLE" ON "C:\EMBARCADERO\Proyectos\021-appCupones\bd_app\tCuponDetalle"("FCD_IDCAJA", "FCD_IDCUPON");




CREATE TABLE IF NOT EXISTS "C:\EMBARCADERO\Proyectos\021-appCupones\bd_app\tCajaConfig"
(
  "FCC_IDCAJA" Integer, 
  "FCC_IDCUPON" Integer, 
  "FCC_VTAMIN" MONEY, 
  "FCC_VTAMAX" MONEY, 
  "FCC_PRINTER" VARCHAR(150), 
  "FCC_CONDICIONES" VARCHAR(20), 
  "FCC_CATEGORIA" VARCHAR(150), 
  "FCC_SUBCATEGORIA" VARCHAR(150), 
  "FCC_PROVEEDOR" VARCHAR(150), 

 
PRIMARY KEY ("FCC_IDCAJA" ) COMPRESS NONE
LOCALE CODE 8202
USER MAJOR VERSION 1
);

CREATE INDEX IF NOT EXISTS "FCC_KEYDETALLE" ON "C:\EMBARCADERO\Proyectos\021-appCupones\bd_app\tCajaConfig"("FCC_IDCAJA", "FCC_IDCUPON");


SELECT FTI_AUTOINCREMENT AS AUTO FROM SOPERACIONINV
WHERE FTI_SERIE = :SerieActiva AND 
FTI_FECHAEMISION = :FechaActual AND
FTI_TIPO = 11 AND FTI_STATUS = 1 AND FTI_VISIBLE = 1
ORDER BY AUTO DESC
TOP 1


SELECT 
  FCC_NUMCUPON     AS CUPON,
  FCM_NOMBRE       AS CAJA,
  FCM_SERIE        AS SERIE,
  FCE_CONCEPTO     AS CONCEPTO,
  FCC_VTAMIN       AS VTAMIN,
  FCC_VTAMAX       AS VTAMAX,
  FCC_PRINTER      AS IMPRESORA,
  FCC_CONDICIONES  AS CONDICIONES,
  FCC_CATEGORIA    AS CATEGORIA,
  FCC_SUBCATEGORIA AS SUBCATEGORIA,
  FCC_PROVEEDOR    AS PROVEEDOR
FROM TCAJACONFIG
INNER JOIN "E:\projectDelphi\P0021-appCupon\appCuponesMain\TCAJAMAESTRO" ON FCC_IDCAJA = FCM_IDCAJA
INNER JOIN "E:\projectDelphi\P0021-appCupon\appCuponesMain\TCUPONEVENTO" ON FCC_IDCUPON = FCE_IDCUPON
